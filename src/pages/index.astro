---
export const prerender = true

import { getCollection } from 'astro:content'
import { Image } from 'astro:assets'
import Base from '@/layouts/Base.astro'
import Card from '@/components/Card.astro'
import CardTitle from '@/components/CardTitle.astro'
import CardEyebrow from '@/components/CardEyebrow.astro'
import CardDescription from '@/components/CardDescription.astro'
import CardCta from '@/components/CardCta.astro'
import Container from '@/components/Container.astro'
import { BlueskyIcon, GitHubIcon, LinkedInIcon, XIcon } from '@/components/SocialIcons.jsx'
import { formatDate } from '@/lib/formatDate.js'
import avatarImage from '@/images/avatar.jpg'
import logoCloudflare from '@/images/logos/cloudflare.svg'
import logoStripe from '@/images/logos/stripe.svg'
import logoAmazon from '@/images/logos/amazon.svg'
import logoApple from '@/images/logos/apple.svg'
import logoAccenture from '@/images/logos/accenture.svg'
import image1 from '@/images/photos/image-1.jpg'
import image2 from '@/images/photos/image-2.jpg'
import image3 from '@/images/photos/image-3.jpg'
import image4 from '@/images/photos/image-4.jpg'
import image5 from '@/images/photos/image-5.jpg'

const allPosts = await getCollection('blog')
const posts = allPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 4)

function getPostSlug(post) {
  const [year, month, , ...rest] = post.id.replace(/\.md$/, '').split('-')
  return `${year}/${month}/${rest.join('-')}`
}

const resume = [
  { company: 'Cloudflare', title: 'Principal Solutions Architect', logo: logoCloudflare, start: '2025', end: 'Present' },
  { company: 'Stripe', title: 'Solutions Architect', logo: logoStripe, start: '2025', end: '2025' },
  { company: 'Amazon Web Services', title: 'Principal Solutions Architect', logo: logoAmazon, start: '2016', end: '2025' },
  { company: 'Apple', title: 'iAd Technology Evangelist', logo: logoApple, start: '2013', end: '2016' },
  { company: 'Accenture', title: 'Senior Manager', logo: logoAccenture, start: '2004', end: '2013' },
]

const photos = [image1, image2, image3, image4, image5]
const rotations = ['rotate-2', '-rotate-2', 'rotate-2', 'rotate-2', '-rotate-2']
---

<Base>
  <Container class="mt-9">
    <div class="max-w-2xl">
      <h1 class="text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100">
        Solutions architect, speaker, technology guy, dad
      </h1>
      <p class="mt-6 text-base text-zinc-600 dark:text-zinc-400">
        I&apos;m Josh, a solutions architect, speaker, house IT guy, and dad. My site
        is some part blog, some part collection of what I&apos;ve done over the last
        twenty plus years.
      </p>
      <div class="mt-6 flex gap-6">
        <a href="https://bsky.app/profile/iamjkahn.com" aria-label="Follow on Bluesky" class="group -m-1 p-1">
          <BlueskyIcon class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" />
        </a>
        <a href="https://github.com/jkahn117" aria-label="Follow on GitHub" class="group -m-1 p-1">
          <GitHubIcon class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" />
        </a>
        <a href="https://www.linkedin.com/in/joshuaakahn/" aria-label="Follow on LinkedIn" class="group -m-1 p-1">
          <LinkedInIcon class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" />
        </a>
        <a href="https://x.com/joshuaakahn" aria-label="Follow on X" class="group -m-1 p-1">
          <XIcon class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" />
        </a>
      </div>
    </div>
  </Container>

  <!-- Photo strip -->
  <div class="mt-16 sm:mt-20">
    <div class="-my-4 flex justify-center gap-5 overflow-hidden py-4 sm:gap-8">
      {photos.map((photo, i) => (
        <div class:list={[
          'relative aspect-[9/10] w-44 flex-none overflow-hidden rounded-xl bg-zinc-100 sm:w-72 sm:rounded-2xl dark:bg-zinc-800',
          rotations[i % rotations.length]
        ]}>
          <Image
            src={photo}
            alt=""
            sizes="(min-width: 640px) 18rem, 11rem"
            class="absolute inset-0 h-full w-full object-cover"
          />
        </div>
      ))}
    </div>
  </div>

  <Container class="mt-24 md:mt-28">
    <div class="mx-auto grid max-w-xl grid-cols-1 gap-y-20 lg:max-w-none lg:grid-cols-2">
      <!-- Recent posts -->
      <div class="flex flex-col gap-16">
        {posts.map((post) => (
          <Card as="article">
            <CardTitle href={post.data.redirect_link ?? `/posts/${getPostSlug(post)}`}>
              {post.data.title}
            </CardTitle>
            <CardEyebrow as="time" datetime={post.data.date.toISOString()} decorate>
              {formatDate(post.data.date)}
            </CardEyebrow>
            <CardDescription>{post.data.summary}</CardDescription>
            <CardCta>Read post</CardCta>
          </Card>
        ))}
      </div>

      <!-- Resume -->
      <div class="space-y-10 lg:pl-16 xl:pl-24">
        <div class="rounded-2xl border border-zinc-100 p-6 dark:border-zinc-700/40">
          <h2 class="flex text-sm font-semibold text-zinc-900 dark:text-zinc-100">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="h-6 w-6 flex-none">
              <path d="M2.75 9.75a3 3 0 0 1 3-3h12.5a3 3 0 0 1 3 3v8.5a3 3 0 0 1-3 3H5.75a3 3 0 0 1-3-3v-8.5Z" class="fill-zinc-100 stroke-zinc-400 dark:fill-zinc-100/10 dark:stroke-zinc-500" />
              <path d="M3 14.25h6.249c.484 0 .952-.002 1.316.319l.777.682a.996.996 0 0 0 1.316 0l.777-.682c.364-.32.832-.319 1.316-.319H21M8.75 6.5V4.75a2 2 0 0 1 2-2h2.5a2 2 0 0 1 2 2V6.5" class="stroke-zinc-400 dark:stroke-zinc-500" />
            </svg>
            <span class="ml-3">Work</span>
          </h2>
          <ol class="mt-6 space-y-4">
            {resume.map((role) => (
              <li class="flex gap-4">
                <div class="relative mt-1 flex h-10 w-10 flex-none items-center justify-center rounded-full shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0">
                  <Image src={role.logo} alt="" class="h-7 w-7" />
                </div>
                <dl class="flex flex-auto flex-wrap gap-x-2">
                  <dt class="sr-only">Company</dt>
                  <dd class="w-full flex-none text-sm font-medium text-zinc-900 dark:text-zinc-100">{role.company}</dd>
                  <dt class="sr-only">Role</dt>
                  <dd class="text-xs text-zinc-500 dark:text-zinc-400">{role.title}</dd>
                  <dt class="sr-only">Date</dt>
                  <dd class="ml-auto text-xs text-zinc-400 dark:text-zinc-500">
                    {role.start} â€” {role.end}
                  </dd>
                </dl>
              </li>
            ))}
          </ol>
        </div>
      </div>
    </div>
  </Container>
</Base>
