---
export const prerender = true

import { getCollection } from 'astro:content'
import Base from '@/layouts/Base.astro'
import SimpleLayout from '@/components/SimpleLayout.astro'
import Card from '@/components/Card.astro'
import CardTitle from '@/components/CardTitle.astro'
import CardEyebrow from '@/components/CardEyebrow.astro'
import CardDescription from '@/components/CardDescription.astro'
import CardCta from '@/components/CardCta.astro'
import { formatDate } from '@/lib/formatDate.js'

const allPosts = await getCollection('blog')
const posts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())

function getPostSlug(post) {
  const [year, month, , ...rest] = post.id.replace(/\.md$/, '').split('-')
  return `${year}/${month}/${rest.join('-')}`
}
---

<Base
  title="Posts"
  description="My long-form posts on technology, various musings, and a back catalog of posts over twenty plus years."
>
  <SimpleLayout
    title="Collected posts from Blogger.com circa 2005 to today."
    intro="Long-form posts on technology, various musings, and a back catalog of posts over twenty plus years in chronological order."
  >
    <div class="md:border-l md:border-zinc-100 md:pl-6 md:dark:border-zinc-700/40">
      <div class="flex max-w-3xl flex-col space-y-16">
        {posts.map((post) => (
          <article class="md:grid md:grid-cols-4 md:items-baseline">
            <Card class="md:col-span-3">
              <CardTitle href={post.data.redirect_link ?? `/posts/${getPostSlug(post)}`}>
                {post.data.title}
              </CardTitle>
              <CardEyebrow
                as="time"
                datetime={post.data.date.toISOString()}
                class="md:hidden"
                decorate
              >
                {formatDate(post.data.date)}
              </CardEyebrow>
              <CardDescription>{post.data.summary}</CardDescription>
              <CardCta>Read post</CardCta>
            </Card>
            <CardEyebrow
              as="time"
              datetime={post.data.date.toISOString()}
              class="mt-1 hidden md:block"
            >
              {formatDate(post.data.date)}
            </CardEyebrow>
          </article>
        ))}
      </div>
    </div>
  </SimpleLayout>
</Base>
